<!-- File: Desktop/Prime/templates/accounts/password_reset_success.html -->

{% extends 'base.html' %}

{% block title %}Password Reset Successful - PrimeTime{% endblock %}

{% block content %}
<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-7">
            <div class="card modern-card">
                <div class="card-header bg-success text-white">
                    <h4><i class='bx bx-check-circle'></i> Password Reset Successful</h4>
                </div>
                <div class="card-body">
                    <!-- Success Message -->
                    <div class="alert alert-success">
                        <h5><i class='bx bx-check-double'></i> Password Has Been Reset</h5>
                        <p class="mb-0">
                            The password for <strong>{{ target_user.display_name }}</strong> has been successfully reset.
                        </p>
                    </div>

                    <!-- User Information -->
                    <div class="user-summary-box mb-4">
                        <div class="row align-items-center">
                            <div class="col-auto">
                                <div class="user-avatar-large">
                                    {% if target_user.profile.profile_picture %}
                                        <img src="{{ target_user.profile.profile_picture.url }}" 
                                             alt="{{ target_user.display_name }}"
                                             class="rounded-circle"
                                             style="width: 80px; height: 80px; object-fit: cover;">
                                    {% else %}
                                        <div class="bg-primary rounded-circle d-flex align-items-center justify-content-center"
                                             style="width: 80px; height: 80px;">
                                            <i class='bx bx-user text-white' style="font-size: 3rem;"></i>
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col">
                                <h5>{{ target_user.display_name }}</h5>
                                <p class="text-muted mb-1">{{ target_user.email }}</p>
                                <span class="badge bg-info">{{ target_user.get_role_display }}</span>
                                <span class="badge bg-warning">User ID: {{ target_user.user_id|default:"-" }}</span>
                            </div>
                        </div>
                    </div>

                    <!-- Generated Password Display -->
                    <div class="password-display-box">
                        <h5 class="mb-3">
                            <i class='bx bx-key'></i> New Generated Password
                        </h5>
                        
                        <div class="password-box">
                            <div class="password-value" id="passwordValue">
                                {{ new_password }}
                            </div>
                            <button class="btn btn-primary btn-copy" onclick="copyPassword()">
                                <i class='bx bx-copy' id="copyIcon"></i>
                                <span id="copyText">Copy</span>
                            </button>
                        </div>

                        <div class="alert alert-warning mt-3">
                            <i class='bx bx-error-circle'></i>
                            <strong>Important:</strong> This password will only be displayed once. 
                            Make sure to copy it and share it securely with the user.
                        </div>

                        <!-- Password Details -->
                        <div class="password-info mt-3">
                            <h6>Password Characteristics:</h6>
                            <ul class="mb-0">
                                <li><i class='bx bx-check text-success'></i> Contains uppercase letters</li>
                                <li><i class='bx bx-check text-success'></i> Contains lowercase letters</li>
                                <li><i class='bx bx-check text-success'></i> Contains numbers</li>
                                <li><i class='bx bx-check text-success'></i> Contains special characters</li>
                                <li><i class='bx bx-check text-success'></i> 9 characters long</li>
                            </ul>
                        </div>
                    </div>

                    <!-- Next Steps -->
                    <div class="next-steps-box mt-4">
                        <h5><i class='bx bx-list-check'></i> Next Steps</h5>
                        <ol>
                            <li>Copy the password using the button above</li>
                            <li>Share the password with {{ target_user.display_name }} through a secure channel (not email)</li>
                            <li>Inform the user they must change this password on their next login</li>
                            <li>User account status: 
                                {% if target_user.is_enabled %}
                                    <span class="badge bg-success">Active - Can login immediately</span>
                                {% else %}
                                    <span class="badge bg-danger">Disabled - Enable account first</span>
                                {% endif %}
                            </li>
                        </ol>
                    </div>

                    <!-- Security Recommendations -->
                    <div class="alert alert-info mt-4">
                        <h6><i class='bx bx-shield'></i> Security Recommendations</h6>
                        <ul class="mb-0">
                            <li>Share the password in person or through encrypted communication</li>
                            <li>Do not send passwords via email or unencrypted messaging</li>
                            <li>Confirm the user changes the password on first login</li>
                            <li>Document the password reset in your admin log</li>
                        </ul>
                    </div>

                    <!-- Action Buttons -->
                    <div class="d-flex gap-2 mt-4">
                        <a href="{% url 'accounts:user_detail' target_user.pk %}" class="btn btn-primary">
                            <i class='bx bx-user'></i> View User Profile
                        </a>
                        <a href="{% url 'accounts:user_list' %}" class="btn btn-secondary">
                            <i class='bx bx-list-ul'></i> Back to User List
                        </a>
                        <button onclick="window.print()" class="btn btn-outline-secondary ms-auto">
                            <i class='bx bx-printer'></i> Print
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .user-summary-box {
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        padding: 24px;
        border-radius: 12px;
        border: 2px solid #dee2e6;
    }
    
    .password-display-box {
        background: #fff3cd;
        padding: 24px;
        border-radius: 12px;
        border: 2px solid #ffc107;
    }
    
    .password-box {
        display: flex;
        align-items: center;
        gap: 12px;
        background: white;
        padding: 16px;
        border-radius: 8px;
        border: 2px solid #dee2e6;
    }
    
    .password-value {
        flex: 1;
        font-family: 'Courier New', monospace;
        font-size: 28px;
        font-weight: bold;
        letter-spacing: 3px;
        color: var(--primary);
        user-select: all;
        padding: 8px;
    }
    
    .btn-copy {
        white-space: nowrap;
        padding: 12px 24px;
        font-weight: 600;
    }
    
    .next-steps-box {
        background: #e7f3ff;
        padding: 20px;
        border-radius: 12px;
        border: 2px solid #0d6efd;
    }
    
    .next-steps-box ol {
        margin-bottom: 0;
        padding-left: 20px;
    }
    
    .next-steps-box ol li {
        padding: 8px 0;
    }
    
    .password-info ul {
        list-style: none;
        padding-left: 0;
    }
    
    .password-info ul li {
        padding: 4px 0;
    }
    
    .password-info ul li i {
        margin-right: 8px;
        font-size: 18px;
    }
    
    @media print {
        .btn, .alert-warning {
            display: none !important;
        }
        
        .password-value {
            font-size: 24px;
        }
    }
</style>

<script>
function copyPassword() {
    const passwordValue = document.getElementById('passwordValue').textContent.trim();
    const copyIcon = document.getElementById('copyIcon');
    const copyText = document.getElementById('copyText');
    
    navigator.clipboard.writeText(passwordValue).then(() => {
        // Success feedback
        copyIcon.className = 'bx bx-check';
        copyText.textContent = 'Copied!';
        
        // Show success message
        const alertDiv = document.createElement('div');
        alertDiv.className = 'alert alert-success position-fixed top-0 end-0 m-3';
        alertDiv.style.zIndex = '9999';
        alertDiv.innerHTML = '<i class="bx bx-check-circle"></i> Password copied to clipboard!';
        document.body.appendChild(alertDiv);
        
        // Reset button after 2 seconds
        setTimeout(() => {
            copyIcon.className = 'bx bx-copy';
            copyText.textContent = 'Copy';
            alertDiv.remove();
        }, 2000);
    }).catch(err => {
        console.error('Failed to copy password:', err);
        alert('Failed to copy password. Please copy it manually.');
    });
}

// Auto-select password on click
document.getElementById('passwordValue').addEventListener('click', function() {
    const range = document.createRange();
    range.selectNodeContents(this);
    const selection = window.getSelection();
    selection.removeAllRanges();
    selection.addRange(range);
});
</script>

{% endblock %}