{% extends 'base.html' %}
{% load static %}

{% block title %}{{ event.title }} - {{ block.super }}{% endblock %}

{% block extra_css %}
<style>
    .event-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 40px;
        border-radius: 12px 12px 0 0;
    }
    .event-type-badge {
        padding: 6px 15px;
        border-radius: 20px;
        font-size: 13px;
        font-weight: 600;
        background: rgba(255,255,255,0.2);
        display: inline-block;
        margin-right: 10px;
    }
    .priority-badge {
        padding: 4px 12px;
        border-radius: 12px;
        font-size: 11px;
        font-weight: 600;
        text-transform: uppercase;
    }
    .priority-low { background: #d4edda; color: #155724; }
    .priority-medium { background: #fff3cd; color: #856404; }
    .priority-high { background: #f8d7da; color: #721c24; }
    .priority-urgent { background: #dc3545; color: white; }
    .event-meta {
        display: flex;
        gap: 30px;
        margin-top: 20px;
        flex-wrap: wrap;
    }
    .event-meta-item i {
        margin-right: 8px;
    }
    .rsvp-section {
        background: white;
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        margin-top: 20px;
    }
    .attendee-list {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-top: 15px;
    }
    .attendee-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 600;
        font-size: 14px;
    }
</style>
{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="card shadow-lg">
        <div class="event-header">
            <div class="d-flex justify-content-between align-items-start">
                <div>
                    <div class="mb-2">
                        <span class="event-type-badge">{{ event.get_event_type_display }}</span>
                        <span class="priority-badge priority-{{ event.priority }}">
                            {{ event.get_priority_display }}
                        </span>
                    </div>
                    <h2 class="mb-0">{{ event.title }}</h2>
                    <div class="event-meta">
                        <div class="event-meta-item">
                            <i class="far fa-calendar"></i>
                            {{ event.start_datetime|date:"F j, Y" }}
                        </div>
                        <div class="event-meta-item">
                            <i class="far fa-clock"></i>
                            {{ event.start_datetime|date:"g:i A" }} - {{ event.end_datetime|date:"g:i A" }}
                        </div>
                        {% if event.location %}
                        <div class="event-meta-item">
                            <i class="fas fa-map-marker-alt"></i>
                            {{ event.location }}
                        </div>
                        {% endif %}
                    </div>
                </div>
                {% if user == event.organizer or user.role == 'admin' %}
                <div>
                    <a href="{% url 'events:event_update' event.pk %}" class="btn btn-light btn-sm">
                        <i class="fas fa-edit"></i> Edit
                    </a>
                </div>
                {% endif %}
            </div>
        </div>

        <div class="card-body">
            <!-- Description -->
            <div class="mb-4">
                <h5><i class="fas fa-align-left"></i> Description</h5>
                <p class="text-muted">{{ event.description|linebreaks }}</p>
            </div>

            {% if event.meeting_link %}
            <div class="alert alert-info">
                <i class="fas fa-video"></i>
                <strong>Online Meeting:</strong>
                <a href="{{ event.meeting_link }}" target="_blank" class="alert-link">
                    Join Meeting <i class="fas fa-external-link-alt"></i>
                </a>
            </div>
            {% endif %}

            <!-- Organizer -->
            <div class="mb-4">
                <h5><i class="fas fa-user-tie"></i> Organizer</h5>
                <div class="d-flex align-items-center">
                    <div class="attendee-avatar">
                        {{ event.organizer.display_name|first|upper }}
                    </div>
                    <div class="ml-3">
                        <strong>{{ event.organizer.display_name }}</strong><br>
                        <small class="text-muted">{{ event.organizer.email }}</small>
                    </div>
                </div>
            </div>

            <!-- RSVP Section -->
            {% if event.participants.all %}
            <div class="rsvp-section">
                <h5><i class="fas fa-users"></i> Attendees ({{ attendances.count }})</h5>

                {% if not event.is_cancelled %}
                    {% if attendance and attendance.status == 'confirmed' %}
                        <div class="alert alert-success">
                            <i class="fas fa-check-circle"></i>
                            You have confirmed attendance for this event
                        </div>
                        <form method="post" action="{% url 'events:rsvp_event' event.pk %}">
                            {% csrf_token %}
                            <input type="hidden" name="status" value="no">
                            <button type="submit" class="btn btn-outline-danger">
                                <i class="fas fa-times"></i> Cancel RSVP
                            </button>
                        </form>
                    {% elif attendance and attendance.status == 'declined' %}
                        <div class="alert alert-danger">
                            <i class="fas fa-times-circle"></i>
                            You have declined this event
                        </div>
                        <form method="post" action="{% url 'events:rsvp_event' event.pk %}">
                            {% csrf_token %}
                            <input type="hidden" name="status" value="yes">
                            <button type="submit" class="btn btn-outline-success">
                                <i class="fas fa-check"></i> Change to Attending
                            </button>
                        </form>
                    {% else %}
                        <p class="text-muted">Will you attend this event?</p>
                        <form method="post" action="{% url 'events:rsvp_event' event.pk %}" class="d-inline">
                            {% csrf_token %}
                            <input type="hidden" name="status" value="yes">
                            <button type="submit" class="btn btn-success mr-2">
                                <i class="fas fa-check"></i> Yes, I'll attend
                            </button>
                        </form>
                        <form method="post" action="{% url 'events:rsvp_event' event.pk %}" class="d-inline">
                            {% csrf_token %}
                            <input type="hidden" name="status" value="no">
                            <button type="submit" class="btn btn-danger mr-2">
                                <i class="fas fa-times"></i> No
                            </button>
                        </form>
                        <form method="post" action="{% url 'events:rsvp_event' event.pk %}" class="d-inline">
                            {% csrf_token %}
                            <input type="hidden" name="status" value="maybe">
                            <button type="submit" class="btn btn-warning">
                                <i class="fas fa-question"></i> Maybe
                            </button>
                        </form>
                    {% endif %}
                {% else %}
                    <div class="alert alert-danger">
                        <i class="fas fa-ban"></i>
                        This event has been cancelled
                    </div>
                {% endif %}

                <div class="attendee-list mt-3">
                    {% for att in attendances %}
                    <div class="attendee-avatar" title="{{ att.user.display_name }} ({{ att.get_status_display }})">
                        {{ att.user.display_name|first|upper }}
                        <small class="badge 
                            {% if att.status == 'confirmed' %}bg-success
                            {% elif att.status == 'declined' %}bg-danger
                            {% else %}bg-secondary{% endif %}">
                            {{ att.status|slice:":1"|upper }}
                        </small>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
        </div>
    </div>

    <div class="mt-3">
        <a href="{% url 'events:event_list' %}" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> Back to Events
        </a>
    </div>
</div>
{% endblock %}
